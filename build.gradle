plugins {
  id "org.openbakery.xcode-plugin" version "0.19.1"
}

project.ext.version = "1.2.0"

xcodebuild {
	scheme = 'DemoApp'
  target = 'DemoApp'
	simulator = true
	destination = ['iPhone 7']
  
}

task buildForTestOnDevice(type:org.openbakery.XcodeBuildForTestTask) {
	scheme = 'DemoApp'
  target = 'DemoApp'
	simulator = false
}


task testOnDevice(type:org.openbakery.XcodeTestRunTask) {
	scheme = 'DemoApp'
  target = 'DemoApp'
	simulator = false

	destination {
  	id = "Renes iPad 2"
	  platform = "iOS"
	}
}


gradle.taskGraph.whenReady { taskGraph ->
  if (taskGraph.hasTask(tasks.testOnDevice)) {
    xcodebuild {
			// define the signig here, because if the variables like `signingCertificateURI` are not set via gradle.properties than the other task should not fail
	    signing {
		    certificateURI = signingCertificateURI           // e.g 'http://example.com/Provisioning/Development.p12'
		    certificatePassword = signingCertificatePassword // the password for the certificateURI
		    mobileProvisionURI = signingMobileProvisionURI   // e.g 'http://example.com/Provisioning/Development.mobileprovision'
	    }
    }
  }
}

task carthageArchive(type:Exec) {
    workingDir '.'
    commandLine 'carthage', 'build', '--archive', '--platform', 'iOS'
}

task binaryRelease(type: Copy) {
    from file("OBTableViewController.framework.zip")
    into file("$buildDir")

    rename '(.+).framework.zip', '$1-' + project.ext.version + '.zip'
}
binaryRelease.dependsOn carthageArchive
